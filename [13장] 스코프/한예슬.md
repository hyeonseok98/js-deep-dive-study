# 13장 스코프

### 스코프 : 식별자가 유효한 범위.

- 모든 식별자(변수 이름, 함수 이름, 클래스 이름 등)는 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효범위가 결정된다.
- 자바스크립트 엔진은 이름이 같은 두개의 변수 중에서 어떤 변수를 참조해야 할 것인지를 결정해야한다. -> 식별자 결정
- 따라서 `스코프란, 자바스크립트 엔진이 식별자를 검색할때 사용하는 규칙`이다.

### 코드의 문맥과 환경

- 렉시컬 환경 : 코드가 어디서 실행되며 주변에 어떤 코드가 있는지. -> 코드의 문맥은 렉시컬 환경으로 이뤄진다.
- 이를 구현한 것이 실행 컨텍스트이며, 모든 코드는 실행 컨텍스트에서 평가되고 실행된다.

<br>

```jsx
var x = "global";

function foo() {
  var x = "local";
  console.log(x);
}
foo();
console.log(x);
```

- 위 예제에서 코드의 바깥영역에 선언된 x 변수는 어디서든 참조할 수 있다.
- foo 함수 내에서 선언된 x변수는 foo 함수 내부에서만 참조할 수 있고, foo 함수 외부에서는 참조할 수 없다.
- 이때, 두개의 x 변수는 `식별자 이름이 동일하지만 자신이 유효한 범위, 즉 스코프가 다른 별개의 변수다.`
- 식별자는 어떤 값을 구별할 수 있어야 하므로 유일해야한다.
- 식별자인 변수 이름은 중복될 수 없다.
- 하나의 값은 유일한 식별자에 연결되어야 한다.

<br>

---

❗`스코프`를 통해 식별자인 `변수 이름의 충돌을 방지`하여 `같은 이름의 변수를 사용할 수 있게 한다.`<br>
❗스코프 내에서 식별자는 유일해야 하지만, 다른 스코프에는 같은 이름의 식별자를 사용할 수 있다. 즉, 스코프는 네임스페이스다.<br>
❗`var` 키워드로 선언된 변수는 같은 스코프 내에서 중복선언이 허용된다. 이는 의도치않게 변수값이 재할당되어 변경되는 부작용을 발생시킨다.<br>
❗let / const 키워드로 선언된 변수는 같은 스코프 내에서 중복선언을 허용하지 않는다.<br>

---

### 스코프의 종류

- 전역 스코프(global) / 지역 스코프(local)

| 구분 |         설명          |   스코프   |   변수   |
| :--: | :-------------------: | :--------: | :------: |
| 전역 | 코드의 가장 바깥 영역 | 전역스코프 | 전역변수 |
| 지역 |    함수 몸체 내부     | 지역스코프 | 지역변수 |

- `전역 스코프는 어디서든지 참조`할 수 있다. -> 함수 내부에서도 참조할 수 있다.
- 지역이란 함수 몸체 내부를 말한다.
- 지역변수는 자신이 선언된 지역과 하위지역 (중첩 함수)에서만 참조할 수 있다.
- 지역변수는 `자신의 지역 스코프`와 `하위 지역 스코프`에서 유효하다.

### 스코프 체인

**`스코프가 계층적으로 연결된 것`을 `스코프 체인`이라 한다.**<br>
**`식별자를 검색하는 규칙.`**

- 스코프 체인은 실행 컨텍스트의 `렉시컬 환경을 단방향으로 연결한 것`이다.
- 함수는 중첩될 수 있으므로, 함수의 지역 스코프도 중첩될 수 있다.
  -> `스코프가 함수의 중첩에 의해 계층적 구조를 갖는다`는것을 의미한다.
- 중첩함수의 지역스코프는 중첩함수를 포함하는 외부함수의 지역스코프와 계층적 구조를 갖는다.
  -> 이때 외부함수의 지역스코프를 `중첩함수의 상위스코프`라 한다.
- 모든 지역 스코프의 최상위 스코프는 전역 스코프다.
- 변수를 참조할때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색한다.
  -> 절대 하위 스코프로 내려가면서 식별자를 검색하는 일은 없다.
- 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만, 하위 스코프에서 유효한 변수를 상위 스코프에서 참조할 수 없다.

### 렉시컬 스코프

- 동적 스코프 : 함수를 어디서 `호출` 했는지에 따라 함수의 상위 스코프를 결정한다.
- 렉시컬 스코프 (정적 스코프) : 함수를 어디서 `정의` 했는지에 따라 함수의 상위 스코프를 결정한다.
- 자바스크립트는 렉시컬 스코프를 따르므로, 함수를 어디서 정의했는지에 따라 함수의 상위 스코프를 결정한다.
- 함수가 호출된 위치는 상위 스코프의 결정에 어떠한 영향도 주지 않는다.
- 즉, 함수의 상위스코프는 언제나 자신이 정의된 스코프다.
- 함수정의가 실행되어 생성된 함수 객체는 이렇게 결정된 상위 스코프를 기억한다. 함수가 호출될때마다 함수의 상위 스코프를 참조할 필요가 있기 때문이다.
