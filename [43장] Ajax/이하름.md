43 Ajax
=======

### 1. Ajax란 ?
- Ajax(Asynchronous JavaScript and XML)는 자바스크립트를 사용해 브라우저가 서버에서 비동기 방식으로 데이터를 요청하고, 서버의 응답 데이터를 수신하여 웹페이지를 동적으로 갱신하는 프로그래밍 방식
- 브라우저에서 제공하는 Web API인 `XMLHttpRequest` 객체를 기반으로 동작
- 역사 : 1999년 마이크로소프트가 개발한 XMLHttpRequest는 초기에는 큰 주목을 받지 못함 / 2005년 구글이 발표한 구글 맵스를 통해 Ajax의 가능성이 널리 알려짐
  ( 구글 맵스_자바스크립트와 Ajax를 기반으로 동작하여 데스크톱 애플리케이션과 비교해도 손색이 없는 퍼포먼스와 부드러운 화면 전환 효과를 제공 )

[ 전통적 / Ajax 의 렌더링 방식의 비교 ]
<img width="700" alt="image" src="https://github.com/hyeonseok98/js-deep-dive-study/assets/144431560/4cb12204-8981-4e69-b986-042cc826354b">

▸ 전통적인 웹페이지 렌더링 방식의 단점
  1. 불필요한 데이터 통신 : 변경할 필요가 없는 부분까지 포함된 완전한 HTML을 매번 서버로부터 전송받아야 함
  2. 비효율적인 렌더링 : 변경할 필요가 없는 부분까지 처음부터 다시 렌더링하여 화면 전환 시 순간적으로 깜빡이는 현상 발생
  3. 동기 통신의 문제 : 클라이언트와 서버 간의 통신이 동기 방식으로 동작하여, 서버 응답이 있을 때까지 다음 처리가 블로킹됨

<img width="700" alt="image" src="https://github.com/hyeonseok98/js-deep-dive-study/assets/144431560/9e21cad5-be7f-4927-98dd-ea856b08fbc0">

- Initial Request : 처음 요청 시 전체 HTML과 리소스를 받아온다. <br>
  ( 브라우저가 페이지를 처음 로드할 때 전체 HTML 문서와 필요한 CSS,JavaScript 파일을 서버로부터 받아옴. <br>
  이때 중요한 초기 데이터는 함께 포함하여 클라이언트에 전달할 수 있다. 즉, 전체 페이지 로드와 함께 필요한 일부 데이터를 미리 받아올 수 있음 )
- Ajax Request : 이후 특정 이벤트 발생 시 클라이언트는 필요한 데이터만 서버로부터 비동기적으로 요청하고, 해당 데이터만 DOM을 통해 업데이트 한다.

▸ Ajax 방식의 장점
  1. 효율적인 데이터 통신 : 필요한 데이터만 서버로부터 비동기 방식으로 전송받아 불필요한 데이터 통신을 방지
  2. 효율적인 렌더링 : 변경할 필요가 없는 부분은 다시 렌더링하지 않아 화면이 깜빡이는 현상 방지
  3. 비동기 통신 : 서버 요청 후에도 블로킹이 발생하지 않아 빠른 퍼포먼스와 부드러운 화면 전환 가능

### 2. JSON
클라이언트와 서버 간의 HTTP 통신을 위한 텍스트 데이터 포맷이며, <br> 
자바스크립트에 종속되지 않는 언어 독립형 데이터 포맷으로 대부분의 프로그래밍 언어에서 사용할 수 있다.
1. JSON 표기방식 <br> 
   JSON은 자바스크립트의 객체 리터럴과 유사하게 키와 값으로 구성된 순수한 텍스트이다.
   ````js
   {
  	"name": "Lee",
    "age": 20,
    "alive": true,
    "hobby": ["travling", "tennis"]
   }
   ````
   - JSON 키는 반드시 큰따옴표(작은 따옴표 X)로 묶어야 한다.
   - 값은 객체 리터럴과 같은 표기법을 그대로 사용 가능. 단, 문자열은 반드시 큰 따옴표로 묶어야 함

2. JSON.stringfy <br>
   - 객체를 JSON 포맷의 문자열로 변환하는 메서드이며, 이를 통해 클라이언트가 `서버로 객체를 전송할 때`객체를 문자열화하는 작업`직렬화`을 수행할 수 있다.
   ````js
   // ▶︎ 객체를 JSON 포맷의 문자열로 변환
   const obj = {
     name: 'Lee',
     age: 20,
     alive: true,
     hobby: ['traveling', 'tennis']
   };
   const json = JSON.stringify(obj);
   console.log(typeof json, json);
   // string {"name":"Lee","age":20,"alive":true,"hobby":["traveling","tennis"]}============

   // ▶︎ JSON 문자열을 보기 좋게 들여쓰기 적용 ( null:모든 속성을 포함하여 변환 / 2:2칸의 공백을 들여쓰기 )
   const prettyJson = JSON.stringify(obj, null, 2);
   console.log(typeof prettyJson, prettyJson);
   /*
   string {
     "name": "Lee",
     "age": 20,
     "alive": true,
     "hobby": [
       "traveling",
       "tennis"
     ]
   }
   */
   // 들여쓰기를 적용하지 않으면 JSON 문자열이 더 짧고 데이터 전송 시 효율적이지만, 디버깅이나 수동으로 데이터를 확인할 때는 가독성이 떨어질 수 있다.

   // ▶︎ Replacer 함수 사용 : 특정 조건에 따라 객체의 속성을 필터링
   function filter(key, value) {
     return typeof value === 'number' ? undefined : value;
   }
   const strFilteredObject = JSON.stringify(obj, filter, 2);
   console.log(typeof strFilteredObject, strFilteredObject);
   /*
   string {
     "name": "Lee",
     "alive": true,
     "hobby": [
       "traveling",
       "tennis"
     ]
   }
   */
   ````
   - 객체뿐 아니라 배열도 JSON 포맷의 문자열로 변환한다.
   ````js
   const todos = [
     { id: 1, content: 'HTML', completed: false },
     { id: 2, content: 'CSS', completed: true },
     { id: 3, content: 'Javascript', completed: false }
   ];

   // 배열을 JSON 포맷의 문자열로 변환한다.
   const json = JSON.stringify(todos, null, 2);
   console.log(typeof json, json);
   /*
   string [
     {
       "id": 1,
       "content": "HTML",
       "completed": false
     },
     {
       "id": 2,
       "content": "CSS",
       "completed": true
     },
     {
       "id": 3,
       "content": "Javascript",
       "completed": false
     }
   ]
   */
   ````

3. JSON.parse
   - JSON 포맷의 문자열을 객체로 변환하는 메서드이며, 클라이언트가 서버로부터 받은 JSON 데이터를 자바스크립트 객체로 사용하기 위해사용
   - 서버로부터 받은 JSON 문자열 데이터를 객체로 변환하는 `역직렬화`과정이다.
   ````js
   const obj = {
     name: 'Lee',
     age: 20,
     alive: true,
     hobby: ['traveling', 'tennis']
   };

   // 객체를 JSON 포맷의 문자열로 변환한다.
   const json = JSON.stringify(obj);

   // JSON 포맷의 문자열을 객체로 변환한다.
   const parsed = JSON.parse(json);
   console.log(typeof parsed, parsed);
   // object {name: "Lee", age: 20, alive: true, hobby: ["traveling", "tennis"]}
   ````
   - 배열의 요소가 객체인 경우 배열의 요소까지 객체로 변환한다.
   ````js
   const todos = [
     { id: 1, content: 'HTML', completed: false },
     { id: 2, content: 'CSS', completed: true },
     { id: 3, content: 'Javascript', completed: false }
   ];

   // 배열을 JSON 포맷의 문자열로 변환한다.
   const json = JSON.stringify(todos);

   // JSON 포맷의 문자열을 배열로 변환한다. 배열의 요소까지 객체로 변환된다.
   const parsed = JSON.parse(json);
   console.log(typeof parsed, parsed);
   /*
    object [
     { id: 1, content: 'HTML', completed: false },
     { id: 2, content: 'CSS', completed: true },
     { id: 3, content: 'Javascript', completed: false }
   ]
   */
   ````
✅  목적  <br>
JSON.stringify:객체를 JSON 문자열로 변환 / JSON.parse:JSON 문자열을 객체로 변환 <br>
✅  사용시점  <br>
JSON.stringify:클라이언트에서 서버로 데이터를 전송할 때 객체를 문자열로 직렬화 / JSON.parse:서버로부터 받은 JSON 데이터를 객체로 역직렬화 <br>
✅  예시  <br> 
JSON.stringify:폼 데이터를 JSON 형식으로 변환하여 서버로 전송 / JSON.parse:서버 응답을 받아서 자바스크립트 객체로 변환하여 사용 

📌 JSON.stringify <br>
- 클라이언트에서 `JSON.stringify` <br>
용도: 자바스크립트 객체를 JSON 문자열로 변환하여 서버로 전송 / 상황: 클라이언트가 서버에 데이터를 전송할 때
````js
const data = { name: 'Lee', age: 20 };
const jsonData = JSON.stringify(data);
fetch('/api/data', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: jsonData
});
````
- 서버에서 `JSON.stringify` <br>
용도: 자바스크립트 객체를 JSON 문자열로 변환하여 클라이언트로 전송하거나 로그에 기록 / 상황: 서버가 클라이언트에게 데이터를 응답할 때 또는 데이터를 로그 파일에 저장할 때
````js
// 서버가 클라이언트에게 응답할 때
const express = require('express');
const app = express();

app.get('/api/data', (req, res) => {
  const data = { name: 'Lee', age: 20 };
  res.json(data); // express는 내부적으로 JSON.stringify를 사용
});

app.listen(3000);
````
````js
// 서버에서 데이터를 로그 파일에 기록할 때
const fs = require('fs');
const data = { name: 'Lee', age: 20 };
const jsonData = JSON.stringify(data);
fs.writeFileSync('log.json', jsonData);
````

📌 JSON.parse <br>
- 클라이언트에서 `JSON.parse` <br>
용도: 서버로부터 받은 JSON 데이터를 자바스크립트 객체로 변환하기 위해 / 상황: 서버로부터 HTTP 응답으로 JSON 문자열을 받았을 때
````js
클라이언트에서 서버로부터 응답을 받았을 때
fetch('/api/data')
  .then(response => response.json()) // 이 부분에서 JSON.parse가 사용됨
  .then(data => {
    console.log(data); // 여기서 data는 자바스크립트 객체
  });

▼ 내부적으로 동작하는 방식
fetch('/api/data')
  .then(response => response.text()) // 응답을 텍스트로 받아옴
  .then(text => JSON.parse(text)) // 텍스트를 JSON 객체로 변환
  .then(data => {
    console.log(data); // 여기서 data는 자바스크립트 객체
  });

````
- 서버에서 `JSON.parse` <br>
용도: 클라이언트로부터 받은 JSON 데이터를 자바스크립트 객체로 변환하기 위해 / 상황: 클라이언트가 HTTP 요청으로 JSON 문자열을 보냈을 때
````js
// Node.js 서버에서 클라이언트로부터 요청을 받았을 때 JSON.parse는 간접적으로 사용된다.
// 이 과정에서 중요한 역할을 하는 것은 express.json() 미들웨어 → JSON 요청 본문을 자동으로 파싱하여 자바스크립트 객체로 변환해줌
const express = require('express');
const app = express();

app.use(express.json()); // JSON 요청 본문을 파싱,(내부적으로 JSON.parse를 호출)자바스크립트 객체로 변환 - 변환된 객체는 req.body에 저장

app.post('/api/data', (req, res) => {
  const data = req.body; // req.body는 이미 파싱된 자바스크립트 객체
  console.log(data); 
  res.send('Data received');
});

app.listen(3000);
````
양쪽 모두에서 사용될 수 있으며, 클라이언트와 서버 간의 데이터 교환이 양방향으로 이루어지기 때문에 각자 데이터를 받아서 변환해야 하는떄에 사용된다.
