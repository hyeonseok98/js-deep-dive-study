# [45ì¥] í”„ë¡œë¯¸ìŠ¤

> ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ ì½œë°± í•¨ìˆ˜ë¥¼ ìì£¼ ì‚¬ìš©í•œë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ° íŒ¨í„´ì€, ì½œë°± ì§€ì˜¥ì„ ë§Œë“¤ì–´ ë‚´ê¸°ì— ê°€ë…ì„±, ìœ ì§€ë³´ìˆ˜ì„±ì´ ì €í•˜ë˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤. ì´ë¥¼ ìœ„í•´ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë„ì…í•´ ë¹„ë™ê¸° ì²˜ë¦¬ ì‹œì ì„ ëª…í™•íˆ í‘œí˜„í•  ìˆ˜ ìˆê²Œ ëë‹¤!

## 45.1 ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì½œë°± íŒ¨í„´ì˜ ë‹¨ì 

### ğŸ“ ì½œë°± ì§€ì˜¥

![ì½œë°± ì§€ì˜¥ ì˜ˆì‹œ](https://res.cloudinary.com/practicaldev/image/fetch/s--c0aEZX7m--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b8euo2n7twvgh3dbuatd.jpeg)

```javascript
// GET ìš”ì²­ì„ ìœ„í•œ ë¹„ë™ê¸° í•¨ìˆ˜
const get = (url) => {
  const xhr = new XMLHttpRequest();

  xhr.open("GET", url);
  xhr.send();

  //  onload ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” get1 í•¨ìˆ˜ ì¢…ë£Œ ì´í›„, ë¹„ë™ê¸°ë¡œ ë™ì‘í•¨
  xhr.onload = () => {
    if (xhr.status === 200) {
      // ì„œë²„ì˜ ì‘ë‹µì„ ì½˜ì†”ì— ì¶œë ¥
      console.log(JSON.parse(xhr.response));
    } else {
      console.error(`${xhr.status} ${xhr.statusText}`);
    }
  };
};

get("https://jsonplaceholder.typicode.com/posts/1");

/*
{
    "userId" : 1,
    "id": 1,
    "title": "...",
    ...
}
*/
```

ìœ„ ì˜ˆì œì—ì„œ, `get` í•¨ìˆ˜ëŠ” ì„œë²„ì˜ ì‘ë‹µì„ ì˜¬ë°”ë¥´ê²Œ ì½˜ì†”ì— ì¶œë ¥í•´ì¤€ë‹¤.

![get í•¨ìˆ˜ ë™ì‘ ê²°ê³¼](./img/get.png)

`get` í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ì¸ë° `get` ì˜ ê²½ìš° í•¨ìˆ˜ê°€ ì¢…ë£Œëœ í›„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ë³„ë„ë¡œ ë™ì‘í•˜ê²Œ ëœë‹¤.

`get` í•¨ìˆ˜ì˜ ë™ì‘ì„ ì´ë²¤íŠ¸ ë£¨í”„ì™€ ì—°ê´€ì§€ì–´ ë¶„ì„í•´ë³´ì.

1. í•¨ìˆ˜ í˜¸ì¶œ: `get()` í•¨ìˆ˜ í˜¸ì¶œ, ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ìƒì„±ë¨
2. XMLHttpRequset ê°ì²´ ìƒì„±
3. ìš”ì²­ ì¤€ë¹„: `xhr.open()` ë¥¼ í†µí•´ GET ìš”ì²­ ì¤€ë¹„
4. ìš”ì²­ ì „ì†¡: `xhr.send()` ë¥¼ í†µí•´ ìš”ì²­ ì „ì†¡

5. onload ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡ => ë‚´ë¶€ì— ì •ì˜í•œ ì½œë°±í•¨ìˆ˜ëŠ” ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ê²Œ ë¨.

6. ì‘ë‹µ ë„ì°©: ì„œë²„ë¡œ ë¶€í„° ì‘ë‹µì´ ë„ì°©í•˜ë©´ ë¸Œë¼ìš°ì €ëŠ” onload ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ íƒœìŠ¤í¬ íì— ì¶”ê°€
7. ì´ë²¤íŠ¸ ë£¨í”„: ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì½œ ìŠ¤íƒì´ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ë©°, ë¹„ê²Œë˜ë©´ íƒœìŠ¤í¬ íì— ì¡´ì¬í•˜ëŠ” ì‘ì—…ì„ ì½œ ìŠ¤íƒìœ¼ë¡œ ì˜®ê¹€.
8. onload ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì‹¤í–‰: ì½œ ìŠ¤íƒì—ì„œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì˜ ë‚´ë¶€ ì½”ë“œë¥¼ ë§ˆì¹¨ë‚´ ì‹¤í–‰

onload ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ”, ì´ë¯¸ `get1` í•¨ìˆ˜ê°€ ì¢…ë£Œëœ í›„ì— ë™ì‘í•˜ê¸°ì— ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ë°›ì•„ì˜¤ëŠ” ê²°ê³¼ë¥¼ `console.log()` ë¡œ ë‚´ë¶€ì—ì„œ ì¶œë ¥í•˜ëŠ” ê²ƒì€ ë™ì‘í•˜ì§€ë§Œ ì™¸ë¶€ë¡œ ë°˜í™˜í•˜ê±°ë‚˜ í• ë‹¹í•˜ë ¤ê³  í•˜ë©´ ë™ì‘í•˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.

ì´ë²ˆì—” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì‘ë‹µì„ ìƒìœ„ ìŠ¤ì½”í”„ë¡œ ë°˜í™˜í•˜ë„ë¡ ë§Œë“¤ì–´ë³´ì.
í•˜ì§€ë§Œ ì´ ì—­ì‹œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

```javascript
const get = (url) => {
  const xhr = new XMLHttpRequest();

  let result;
  xhr.open("GET", url);
  xhr.send();

  //  onload ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” get1 í•¨ìˆ˜ ì¢…ë£Œ ì´í›„, ë¹„ë™ê¸°ë¡œ ë™ì‘í•¨
  xhr.onload = () => {
    if (xhr.status === 200) {
      // ì„œë²„ì˜ ì‘ë‹µì„ ë°˜í™˜
      result = xhr.response;
      return JSON.parse(xhr.response);
    } else {
      console.error(`${xhr.status} ${xhr.statusText}`);
    }
  };

  console.log(result); // undefined
};

const response = get("https://jsonplaceholder.typicode.com/posts/1");
console.log(response); // undefined
```

ì•ì„œ ì´ì•¼ê¸°í•œ ê²ƒ ì²˜ëŸ¼, `get` í•¨ìˆ˜ì˜ ê²°ê³¼ë¥¼ `get` í•¨ìˆ˜ì˜ ìƒìœ„ ìŠ¤ì½”í”„ ë³€ìˆ˜ì— í• ë‹¹í•˜ë ¤ê³  í•´ë„ ì˜ë„ì²˜ëŸ¼ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ìƒìœ„ ìŠ¤ì½”í”„ë¡œ ê°’ì„ í• ë‹¹í•˜ë ¤ê³  í•´ë„ ë¶ˆê°€ëŠ¥í•œ ì´ìœ ëŠ”, ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ í˜¸ì¶œëœ ìƒí™©ì—ì„œ ìƒìœ„ ìŠ¤ì½”í”„ì˜ ì½”ë“œëŠ” ì´ë¯¸ ì‹¤í–‰ì´ ëª¨ë‘ ëë‚œ ë’¤ê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ë˜ì„œ, ì½œë°± í•¨ìˆ˜ í˜•íƒœì¸ ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ì—ì„œ ì²˜ë¦¬ë¥¼ ì§ì ‘ í•´ì•¼ë§Œ í•˜ëŠ” ê²ƒì´ë‹¤. (ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ `console.log(xhr.response)` í•˜ë“¯ì´)

í•˜ì§€ë§Œ ë‹¤ì–‘í•œ ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ ì½œë°±í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ë‹¤ ë³´ë‹ˆ, ì²˜ìŒì— ë³¸ ê²ƒ ì²˜ëŸ¼ ë³µì¡í•œ ì½œë°± ì§€ì˜¥ì´ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒ!

ì´ ì½œë°± ì§€ì˜¥ì€ ê°€ë…ì„±ì„ ë–¨ì–´íŠ¸ë¦´ ë¿ ì•„ë‹ˆë¼, ìœ ì§€ë³´ìˆ˜ë„ ì–´ë µê²Œ ë§Œë“ ë‹¤.

```javascript
try {
  setTimeout(() => {
    throw new Error("Error!");
  }, 1000);
} catch (err) {
  console.error("ì—ëŸ¬ ë°œìƒ", err);
}
```

ì´ë ‡ê²Œ ì‘ì„±í•˜ë©´, ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë”ë¼ë„ catch ë¬¸ì´ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

![try-catch ë¬¸](./img/trycatch.png)

ê·¸ëƒ¥ setTimeout ì˜ ì½œë°±í•¨ìˆ˜ê°€ ë™ì‘í•  ë¿ì´ë‹¤.

ê·¸ ì´ìœ ëŠ”, catch ë¬¸ì´ ë™ì‘í•˜ê¸° ìœ„í•´ì„œëŠ” setTimeout ì˜ ì½œë°±í•¨ìˆ˜ê°€ ìƒìœ„ ìŠ¤ì½”í”„ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ë“¤ì´ ì¡´ì¬í•  ë•Œ ë™ì‘í•´ì•¼í•œë‹¤.

ì•ì„œ ë‹¤ë¤˜ë˜ ê²ƒ ì²˜ëŸ¼, ì´ë¯¸ ë‹¤ë¥¸ ì½”ë“œì˜ ì‹¤í–‰ì´ ëª¨ë‘ ëë‚˜ê³  `() => {
    throw new Error("Error!");
  }` ì´ ì½”ë“œ í•˜ë‚˜ë§Œ ë‚¨ì•„ìˆëŠ” ìƒí™©ì¸ ê²ƒì´ë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, Promise ë¥¼ ë„ì…í•´ ë³´ë‹¤ ê°„ê²°í•˜ê²Œ í‘œí˜„í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.

## 45.2 í”„ë¡œë¯¸ìŠ¤ì˜ ìƒì„±

Promise ëŠ” `new` ì—°ì‚°ì + `Promise ìƒì„±ì í•¨ìˆ˜` í˜•íƒœë¡œ ìƒì„±í•˜ë©´ ëœë‹¤.

Promise ìƒì„±ì í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•  ì½œë°±í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ë°›ëŠ”ë‹¤.

ì˜ˆì‹œë¥¼ ë³´ë©´ì„œ ì•Œì•„ë³´ì.

```javascript
const promise = new Promise((resolve, reject) => {
  // Promise í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ ì •ì˜
  if (suceess) {
    resolve("result");
  } else {
    reject("failure reason");
  }
});
```

ìœ„ í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì„±ê³µí•˜ë©´ resolve í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³ , ì‹¤íŒ¨í•˜ë©´ reject í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

ì´ë¥¼ í†µí•´ ì˜ˆì‹œë¡œ ë“¤ì—ˆë˜ `get` í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ êµ¬í˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŒ.

```javascript
const promsisGet = (url) => {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();
    xhr.open("GET");
    xhr.send();

    xhr.onload = () => {
      if (xhr.status === 200) {
        resolve(JSON.parse(xhr.response));
      } else {
        reject(new Error(xhr.status));
      }
    };
  });
};

promiseGet("https://jsonplaceholder.typicode.com/posts/1");
```

ìƒˆë¡­ê²Œ ì‘ì„±í•œ í•¨ìˆ˜ `promiseGet`ì€ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í”„ë¡œë¯¸ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•œë‹¤. ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì„±ê³µí•˜ë©´ ê·¸ ê²°ê³¼ë¥¼ `resolve()` í•¨ìˆ˜ì— ì¸ìˆ˜ë¡œ ì „ë‹¬í•œë‹¤. ë§Œì•½, ì‹¤íŒ¨í•œë‹¤ë©´ ê·¸ ê²°ê³¼ë¥¼ `reject()` í•¨ìˆ˜ì— ì¸ìˆ˜ë¡œ ì „ë‹¬í•´ í˜¸ì¶œí•œë‹¤.

í”„ë¡œë¯¸ìŠ¤ëŠ” 3ê°€ì§€ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ìƒíƒœ ì •ë³´ë¥¼ í‘œí˜„í•œë‹¤.

| ìƒíƒœ | ì˜ë¯¸ | ìƒíƒœ ë³€ê²½ ì¡°ê±´ |
| pending | ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì•„ì§ ìˆ˜í–‰ë˜ì§€ ì•Šì€ ìƒíƒœ | í”„ë¡œë¯¸ìŠ¤ê°€ ìƒì„±ëœ ì§í›„ ê¸°ë³¸ ìƒíƒœ |
| fulfilled | ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ìˆ˜í–‰ëœ ìƒíƒœ(ì„±ê³µ) | resolve í•¨ìˆ˜ í˜¸ì¶œ |
| rejected | ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ìˆ˜í–‰ëœ ìƒíƒœ(ì‹¤íŒ¨) | reject í•¨ìˆ˜ í˜¸ì¶œ |

![promiseì˜ ìƒíƒœ](./img/promisestatus.png)

![fulfilled ìƒíƒœì˜ promise](./img/fulfilled.png)

![rejected ìƒíƒœì˜ promise](./img/rejected.png)

## 45.3 í”„ë¡œë¯¸ìŠ¤ì˜ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œ

í”„ë¡œë¯¸ìŠ¤ê°€ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ìˆëŠ”ì§€ ì•Œì•˜ìœ¼ë‹ˆ, í™œìš©í•˜ëŠ” ì˜ˆì‹œë¥¼ ë³´ì.

ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ì„±ê³µí•´ í”„ë¡œë¯¸ìŠ¤ê°€ fulfilled ìƒíƒœê°€ ë˜ë©´ ì´ ê²°ê³¼ë¥¼ ê°€ì§€ê³  ë‹¤ìŒ ì‘ì—…ì„ ì§„í–‰í•  ê²ƒì´ê³ , rejected ìƒíƒœê°€ ë˜ë©´ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•˜ê²Œ ë  ê²ƒì´ë‹¤. ì´ë¥¼ ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œë“¤ì„ ì•Œì•„ë³´ì!

### ğŸ“ Promise.prototype.then

`then` ë©”ì„œë“œëŠ” ë‘ ê°œì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.

ì²« ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” fulfilled ìƒíƒœì¼ ë•Œ ê·¸ ê²°ê³¼ë¥¼ ê°€ì§€ê³  ë™ì‘í•˜ë©°, ë‘ ë²ˆì§¸ ì½œë°± í•¨ìˆ˜ëŠ” rejected ìƒíƒœì¼ ë•Œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•œë‹¤.

```javascript
new Promise((resolve) => resolve("fulfilled")).then(
  (value) => console.log("fulfilled : ", value),
  (err) => console.error("error : ", err)
); // fulfilled

new Promise((_, reject) => reject(new Error("rejected"))).then(
  (value) => console.log("fulfilled : ", value),
  (err) => console.error("error : ", err)
); // rejected
```

then ì€ ì–¸ì œë‚˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

### ğŸ“ Promise.prototype.catch

catch ë©”ì„œë“œëŠ” í•œ ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ ë°›ëŠ”ë‹¤.
ì´ ì½œë°±í•¨ìˆ˜ëŠ” rejected ìƒíƒœì¼ ë•Œë§Œ í˜¸ì¶œëœë‹¤.

```javascript
new Promise((_, reject) => reject(new Error("rejected"))).catch(
    (error) => console.log(error); // Error: rejected
)
```

catch ì—­ì‹œ ë§ˆì°¬ê°€ì§€ë¡œ, ì–¸ì œë‚˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

```javascript
new Promise((_, reject) => reject(new Error("rejected"))).then(
    (undefined, err) => console.log(err); // Error: rejected
)
```

### ğŸ“ Promise.prototype.finally

finally ë©”ì„œë“œëŠ” í•œ ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.
finally ë©”ì„œë“œì˜ ì½œë°± í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ì„±ê³µ / ì‹¤íŒ¨ ì—¬ë¶€ì— ê´€ê³„ ì—†ì´ ë¬´ì¡°ê±´ í•œ ë²ˆ í˜¸ì¶œëœë‹¤.

```javascript
new Promise(() => {}).finally(
  () => console.log("finally") // finally
);
```

```javascript
const promiseGet = (url) => {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();

    xhr.open("GET", url);
    xhr.send();

    xhr.onload = () => {
      if (xhr.status === 200) {
        // ì²˜ë¦¬ ì„±ê³µ ì‹œ resolve í˜¸ì¶œ
        resolve(JSON.parse);
      } else {
        // ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì¶”ê°€
        reject(new Error(xhr.status));
      }
    };
  });
};

promiseGet("https://jsonplaceholder.typicode.com/posts/1")
  //  ì„±ê³µ ì‹œ ê²°ê³¼ ì¶œë ¥
  .then((res) => console.log(res))
  //  ì˜¤ë¥˜ ë°œìƒ ì‹œ ì¶œë ¥
  .catch((err) => console.error(err))
  //  ë¬´ì¡°ê±´ í˜¸ì¶œ
  .finally(() => console.log("Bye!"));
```

## 45.4 í”„ë¡œë¯¸ìŠ¤ì˜ ì—ëŸ¬ ì²˜ë¦¬

ì•ì„œ ë‹¤ë£¬ ê²ƒ ì²˜ëŸ¼, `then()` ë˜í•œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.

```javascript
const wrongUrl = "https://jsonplaceholder.typicode.com/wrongUrl/1";

promiseGet(wrongUrl)
  .then((res) => console.log(res))
  .then((undefined, err) => console.error(err));
```

ë‹¤ë§Œ, ì´ë ‡ê²Œ í•˜ë©´ ì²« ë²ˆì§¸ ì½œë°±ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë©´ ì²˜ë¦¬ê°€ ì–´ë µë‹¤.

ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```javascript
promiseGet("https://jsonplaceholder.typicode.com/wrongUrl/1").then(
  (res) => console.log(res),
  (err) => console.error(err)
);
```

í•˜ì§€ë§Œ ì´ë ‡ê²Œ ì‘ì„±í•˜ë©´ ê°€ë…ì„±ì´ ë–¨ì–´ì§€ë‹ˆ, catch ë¥¼ ì‚¬ìš©í•˜ì.

```javascript
promiseGet("https://jsonplaceholder.typicode.com/wrongUrl/1")
  .then((res) => console.log(err))
  .catch((err) => console.error(err));
```

## 45.5 í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹

ì•ì„œ í”„ë¡œë¯¸ìŠ¤ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œë“¤ì€ ì–¸ì œë‚˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤ê³  í–ˆë‹¤.
ë”°ë¼ì„œ, í›„ì† ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œ ë’¤ ì²´ì´ë‹ì´ ê°€ëŠ¥í•˜ë‹¤.

```javascript
const url = "https://jsonplaceholder.typicode.com";

// promiseGet => id ê°€ 1 ì¸ post ì–»ì–´ì˜´
promiseGet(`${url}/posts/1`)
// ì´ë¥¼ í†µí•´ ê¸€ ì‘ì„±ìì˜  userId ì–»ì–´ì˜´
.then({ userId } => promiseGet(`${url}/users/${userId}`))
// ì´ë¥¼ í†µí•´ ì–»ì–´ì˜¨ ìœ ì € ì •ë³´ ì¶œë ¥
.then((userInfo) => console.log(userInfo))
// ì˜¤ë¥˜ ë°œìƒì‹œ ì˜¤ë¥˜ ì¶œë ¥
.catch((err) => console.error(err))
```

ìœ„ ë©”ì„œë“œë“¤ì€ ìì²´ë¡œ ë°˜í™˜ ê°’ì´ í”„ë¡œë¯¸ìŠ¤ê°€ ì•„ë‹ˆë”ë¼ë„ ëª¨ë‘ ê°’ì„ í”„ë¡œë¯¸ìŠ¤ë¡œ ë³€í™˜í•´ì„œë¼ë„ ë°˜í™˜í•œë‹¤.

í”„ë¡œë¯¸ìŠ¤ë¥¼ í†µí•´ ì½œë°± ì§€ì˜¥ì€ í•´ê²°í–ˆìœ¼ë‚˜, ì²´ì´ë‹ì—ì„œë„ ì½œë°±í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— ì™„ì „ í•´ê²°í•œ ê²ƒì€ ì•„ë‹ˆë‹¤.

ê²°êµ­ ì²´ì´ë‹ì´ ê¹Šì–´ì§€ë©´ ì½œë°± í•¨ìˆ˜ì˜ ì‚¬ìš©ì´ ëŠ˜ì–´ë‚˜ê³ , ë˜ ë‹¤ë¥¸ í˜•íƒœì˜ ì½œë°± ì§€ì˜¥ì´ ë§Œë“¤ì–´ì§„ë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ë™ê¸° ì²˜ë¦¬ í˜•íƒœë¡œ ë™ì‘í•˜ê²Œ ë§Œë“¤ì–´ì£¼ëŠ” async / await ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```javascript
const url = "https://jsonplaceholder.typicode.com";

// ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜
(async () => {
    // promiseGet => id ê°€ 1 ì¸ post ì–»ì–´ì˜´
    const { userId } => await promiseGet(`${url}/posts/1$`)
    // ì´ë¥¼ í†µí•´ ê¸€ ì‘ì„±ìì˜  userId ì–»ì–´ì˜´
    const userInfo => await promiseGet(`${url}/users/${userId}`);
    // ì´ë¥¼ í†µí•´ ì–»ì–´ì˜¨ ìœ ì € ì •ë³´ ì¶œë ¥
    console.log(userInfo);
})();
```

async / await ì€ ë‹¤ìŒì— ë‹¤ì‹œ ë‹¤ë£° ê²ƒ

## 45.6 í”„ë¡œë¯¸ìŠ¤ì˜ ì •ì  ë©”ì„œë“œ

### ğŸ“ Promise.resolve / Promise.reject

```javascript
const resolvedPromise1 = Promise.resolve([1, 2, 3]);
resolvedPromise1.then(console.log); // [1, 2, 3]

const resolvedPromise2 = new Promise((resolve) => resolve([1, 2, 3]));
resolvedPromise2.then(console.log); // [1, 2, 3]
```

```javascript
const rejectedPromise1 = Promise.reject(new Error("Error!"));
rejectedPromise1.catch(console.log); // Error: Error!

const rejectedPromise2 = new Promise((_, reject) =>
  reject(new Error("Error!"))
);
rejectedPromise2.catch(console.log); // Error: Error;
```

### ğŸ“ Promise.all

Promise.all ë©”ì„œë“œëŠ” ì—¬ëŸ¬ ê°œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ëª¨ë‘ ë³‘ë ¬ ì²˜ë¦¬ í• ë•Œ ì‚¬ìš©.

```javascript
const requestData1 = () =>
  new Promise((resolve) => setTimeout(() => resolve(1), 3000));
const requestData2 = () =>
  new Promise((resolve) => setTimeout(() => resolve(2), 2000));
const requestData3 = () =>
  new Promise((resolve) => setTimeout(() => resolve(3), 1000));

// ì„¸ ê°œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬
const res = [];

requestData1() // 3ì´ˆ ëŒ€ê¸° í›„ data ì— 1 ì´ ì „ë‹¬ë¨.
  .then((data) => {
    res.push(data);
    return requestData2();
  }) // 2ì´ˆ ëŒ€ê¸° í›„ data ì— 2 ê°€ ì „ë‹¬
  .then((data) => {
    res.push(data);
    return requestData3();
  }) //
  .then((data) => {
    res.push(data);
    console.log(res); // [1, 2, 3]
  })
  .catch(console.error);
```

ìœ„ ì½”ë“œë¥¼ `Promise.all` ì„ í†µí•´ ê³ ì³ë³´ì.

```javascript
const requestData1 = () =>
  new Promise((resolve) => setTimeout(() => resolve(1), 3000));
const requestData2 = () =>
  new Promise((resolve) => setTimeout(() => resolve(2), 2000));
const requestData3 = () =>
  new Promise((resolve) => setTimeout(() => resolve(3), 1000));

Promise.all([requestData1(), requestData2(), requestData3()])
  .then(console.log) // [1, 2, 3]
  .catch(console.error);
```

`Promise.all` ì„ í†µí•´ í›¨ì”¬ ê°„ê²°í•´ì¡Œë‹¤!

ì´ ë©”ì„œë“œëŠ” ë°°ì—´ì„ ì¸ìˆ˜ë¡œ ì „ë‹¬ ë°›ìœ¼ë©°, ê·¸ ë°°ì—´ì˜ ìš”ì†ŒëŠ” í”„ë¡œë¯¸ìŠ¤ê°€ ëœë‹¤.
ê° ìš”ì†Œë“¤ì€ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ê¸°ì— ìˆœì„œ ë³´ì¥ì´ ëœë‹¤.
ë”°ë¼ì„œ, ë°°ì—´ì˜ ëª¨ë“  í”„ë¡œë¯¸ìŠ¤ê°€ fulfilled ìƒíƒœê°€ ë˜ì–´ì•¼ ì¢…ë£Œê°€ ë˜ë©°, ê° ìš”ì†Œë§ˆë‹¤ `resolve` ë¡œ ì „ë‹¬ëœ ê°’ë“¤ì„ ë°°ì—´ì— ë‹´ì•„ ë°˜í™˜í•œë‹¤.

í•˜ë‚˜ë¼ë„ `reject` ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°, ì—ëŸ¬ë¥¼ reject í•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

â— ì¶”ê°€ ì˜ˆì‹œ â—

```javascript
const allPokemonPromises = [...Array(PAGE_SIZE)]
  .map((_, index) => {
    // index ì™€ offset ì„ ì´ìš©í•´, í˜ì´ì§€ë³„ë¡œ ë‚˜ëˆ ì„œ ê°€ì ¸ì˜¤ë„ë¡ êµ¬í˜„
    const id = index + 1 + offset;
    if (id > TOTAL_POKEMON) return null;

    return Promise.all([
      axios.get(`https://pokeapi.co/api/v2/pokemon/${id}`),
      axios.get(`https://pokeapi.co/api/v2/pokemon-species/${id}`),
    ]);
  })
  .filter(isNotNull);

const allPokemonResponses = await Promise.all(allPokemonPromises);

const allPokemonData = allPokemonResponses.map(
  ([response, speciesResponse]) => {
    const koreanName = speciesResponse.data.names.find(
      (name: any) => name.language.name === "ko"
    );
    return { ...response.data, korean_name: koreanName?.name || null };
  }
);
```

### ğŸ“ Promise.race

`Promise.race` ë©”ì„œë“œëŠ” Promise.all ë©”ì„œë“œì™€ ë™ì¼í•˜ê²Œ ë°°ì—´ ê°™ì€ ì´í„°ëŸ¬ë¸”ì„ ì¸ìˆ˜ë¡œ ì „ë‹¬ ë°›ëŠ”ë‹¤.

ë‹¤ë§Œ, ìˆœì„œë¥¼ ë³´ì¥ í•˜ì§€ ì•Šìœ¼ë©° ê°€ì¥ ë¨¼ì € fulfilled ìƒíƒœê°€ ëœ í”„ë¡œë¯¸ìŠ¤ì˜ ì²˜ë¦¬ ê²°ê³¼ë¥¼ resolve í•œë‹¤.

```javascript
const requestData1 = () =>
  new Promise((resolve) => setTimeout(() => resolve(1), 3000));
const requestData2 = () =>
  new Promise((resolve) => setTimeout(() => resolve(2), 2000));
const requestData3 = () =>
  new Promise((resolve) => setTimeout(() => resolve(3), 1000));

Promise.race([requestData1(), requestData2(), requestData3()])
  .then(console.log) // [1, 2, 3]
  .catch(console.error);
```

ì´ ì—­ì‹œ ë™ì¼í•˜ê²Œ ì—ëŸ¬ë¥¼ reject í•˜ëŠ” ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

### ğŸ“ Promise.allsettled

`Promise.allsettled` ë©”ì„œë“œëŠ” ì—­ì‹œë„ í”„ë¡œë¯¸ìŠ¤ë¥¼ ìš”ì†Œë¡œ ê°–ëŠ” ë°°ì—´ ë“± ì´í„°ëŸ¬ë¸”ì„ ì¸ìˆ˜ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.

ì „ë‹¬ ë°›ì€ í”„ë¡œë¯¸ìŠ¤ê°€ ëª¨ë‘ settled ìƒíƒœ(ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ìˆ˜í–‰ëœ ìƒíƒœ, ì¦‰ fulfilled or rejected ìƒíƒœ)ê°€ ë˜ë©´ ê·¸ ê²°ê³¼ë¥¼ ë°°ì—´ë¡œ ë°˜í™˜í•œë‹¤.

```javascript
Promise.allSettled([
  new Promise((resolve) => setTimeout(() => resolve(1), 2000)),
  new Promise((_, reject) =>
    setTimeout(() => reject(new Error("Error!")), 1000)
  ),
]).then(console.log);
```

`[
{status: "fulfilled", value: 1}, // fulfilled ìƒíƒœ
{status: "rejected", reason: Error: Error! at <anonymous>:3:60} // rejected ìƒíƒœ
]`

## 45.7 ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ í

```javascript
setTimeout(() => console.log(1), 0);

Promise.resolve()
  .then(() => console.log(2))
  .then(() => console.log(3));
```

ì´ ì½”ë“œì˜ ì‹¤í–‰ ê²°ê³¼ëŠ”, `2 -> 3 -> 1` ì´ ëœë‹¤.
ì´ëŠ” í”„ë¡œë¯¸ìŠ¤ì˜ í›„ì† ì²˜ë¦¬ ë©”ì„œë“œ(then)ì€ `ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ í`ë¼ëŠ” ë³„ë„ì˜ íì— ì €ì¥ë˜ê¸° ë•Œë¬¸ì´ë‹¤.

í›„ì† ì²˜ë¦¬ ë©”ì„œë“œëŠ” ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì— ì €ì¥ë˜ê³ , ë¹„ë™ê¸° í•¨ìˆ˜ì˜ ì½œë°± í•¨ìˆ˜ë‚˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” ì•ì„œ ë°°ìš´ íƒœìŠ¤í¬ íì— ì €ì¥ë˜ëŠ” ê²ƒì´ë‹¤.

ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íëŠ” íƒœìŠ¤í¬ í ì²˜ëŸ¼ ì‘ì—…ì„ ì¼ì‹œ ì €ì¥í•˜ê³  ìˆì§€ë§Œ ìš°ì„ ìˆœìœ„ê°€ íƒœìŠ¤í¬ í ë³´ë‹¤ ë†’ë‹¤. ë”°ë¼ì„œ, ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì½œ ìŠ¤íƒì´ ë¹„ë©´ íƒœìŠ¤í¬ í ë³´ë‹¤ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì— ìˆëŠ” í•¨ìˆ˜ë¥¼ ë¨¼ì € ê°€ì ¸ì™€ ì‹¤í–‰í•œë‹¤.

íƒœìŠ¤í¬ íëŠ” ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íê°€ ì „ë¶€ ë¹„ì›Œì§€ë©´ ì‹¤í–‰ ëœë‹¤.

## 45.8 fetch

`fetch` ëŠ” HTTP ìš”ì²­ ì „ì†¡ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” Web API ë‹¤.
êµì¬ì—ì„œ ë‹¤ë£¬ `XMLHttpRequest` ê°ì²´ë³´ë‹¤ ê°„ë‹¨í•œ ì‚¬ìš©ë²•ì—, í”„ë¡œë¯¸ìŠ¤ë¥¼ ì§€ì›í•˜ë‹ˆ fetch ë¥¼ ì‚¬ìš©í•˜ì!

```javascript
// ìš”ì²­ì„ ì „ì†¡í•  url, HTTP ìš”ì²­ ë©”ì„œë“œ, í˜ì´ë¡œë“œ ë“±ì„ ì„¤ì •í•œ ê°ì²´ ì „ë‹¬í•¨
const promise = fetch(url [, options])
```

```javascript
fetch("https://jsonplaceholder.typicode.com/todos/1").then((response) =>
  console.log(response)
);
```

fetch í•¨ìˆ˜ì— then ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ í”„ë¡œë¯¸ìŠ¤ê°€ resolve í•œ Response ê°ì²´ë¥¼ ì–»ì„ ìˆ˜ ìˆê²Œ ëœë‹¤. ì´ Response ê°ì²´ëŠ” HTTP ì‘ë‹µì— ëŒ€í•œ ì •ë³´ (ìš”ì²­í•œ url ì´ë‚˜ 200, 404, 500 ê°™ì€ status ë“± í¬í•¨)

ì—¬ê¸°ì—ì„œ, MIME íƒ€ì…ì´ application/json ì¸ body ë¥¼ ì–»ê³  ì‹¶ë‹¤ë©´ `response.json()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì–»ì–´ì˜¬ ìˆ˜ ìˆë‹¤.

â—fetch ë¥¼ ì‚¬ìš©í•  ë•Œ ì—ëŸ¬ ì²˜ë¦¬ì— ê´€í•œ ìœ ì˜ ì‚¬í•­

```javascript
const wrongUrl = "https://jsonplaceholder.typicode.com/abababab/";

fetch(wrongUrl)
  .then(() => console.log("ok"))
  .catch(() => console.log("error"));
```

ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´, ok ê°€ ì¶œë ¥ëœë‹¤.
ì˜ëª»ëœ url ì— ìš”ì²­ì„ ë³´ë‚¼ ê²½ìš°, 404 Not Found ë˜ëŠ” 500 Internal Server Error ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

ê·¸ëŸ¬ë‚˜ fetch ëŠ” ì´ê²ƒì„ reject í•˜ì§€ ì•Šê³ , resolve ë¥¼ í•œë‹¤. reject ë¥¼ í•˜ëŠ” ìƒí™©ì€ CORS ì—ëŸ¬ë‚˜ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì—ë§Œ ì¼ì–´ë‚˜ë‹ˆ ì°¸ê³ !

ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´ `Response` ê°ì²´ì—ì„œ `ok` í”„ë¡œí¼í‹°ì˜ ê°’ì´ false ì¸ ê²ƒì„ í™•ì¸í•˜ë©´ ëœë‹¤.

```javascript
const wrongUrl = "https://jsonplaceholder.typicode.com/abababab/";

fetch(wrongUrl).then((res) => {
  if (res.ok) return res.json();
  else throw new Error(res.statusText); // 404, 500 ë“±
});
```

fetch ë¥¼ í†µí•´ GET, POST, PATCH, DELETE ìš”ì²­ì„ ë³´ë‚´ëŠ” ì˜ˆì‹œë¥¼ ê°„ë‹¨í•˜ê²Œ ì‚´í´ë³´ì.

```javascript
const request = {
  get(url) {
    return fetch(url);
  },
  post(url, payload) {
    return fetch(url, {
      method: "POST",
      headers: { "content-Type": "application/json" },
      body: JSON.stringify(payload),
    });
  },
  patch(url, payload) {
    return fetch(url, {
      method: "PATCH",
      headers: { "content-Type": "application/json" },
      body: JSON.stringify(payload),
    });
  },
  delete(url) {
    return fetch(url, { method: "DELETE" });
  },
};
```

ğŸ“š axios ë¥¼ ì‚¬ìš©í•˜ë©´, 200 ì„ ì œì™¸í•œ ëª¨ë“  HTTP ì—ëŸ¬ì— ëŒ€í•´ reject ë¥¼ í•´ì¤€ë‹¤!
ê·¸ë˜ì„œ í¸ì˜ì— ë”°ë¼ axios ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ì¢‹ë‹¤!
